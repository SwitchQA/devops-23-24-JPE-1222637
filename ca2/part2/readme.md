# CA2: Build Tools with Gradle

Start Date: 4, April

End Date: 17, April

[Git Repository](https://github.com/SwitchQA/devops-23-24-JPE-1222637)

## Part 2: Build Tools with Gradle

* Create a new branch called tut-basic-gradle using the following command

```cmd
git checkout -b tut-basic-gradle
```

* Use https://start.spring.io to start a new gradle spring boot project with the following dependencies: Rest
  Repositories; Thymeleaf; JPA; H2
* Use the following image as reference

![this image](tut_resources/spring_init.png)

* Extract the generated zip file inside the folder ”CA2/Part2/” of your repository.
* We now have an ”empty” spring application that can be built using gradle.
* You can check the available gradle tasks by executing ```cmd./gradlew tasks.```
* Delete the src folder. We want to use the code from the basic tutorial
* Copy the src folder (and all its subfolders) from the basic folder of the tutorial into this new folder.
* Copy also the files webpack.config.js and package.json
* Delete the folder src/main/resources/static/built/ since this folder should be generated from the javascrit by the
  webpack tool.
* You can now experiment with the application by using ```cmd ./gradlew bootRun.```
* Notice that the web page http://localhost:8080 is empty! This is because gradle is missing the plugin for dealing with
  the frontend code!

** IMPORTANT**

* Change imports in Employee.java *javax* to *jakarta*
* Add ```json "packageManager": "npm@9.6.7", ``` to package.json
* Add one of the following lines to the plugins block in build.gradle (select the line according to your version of
  java: 8, 11 or 17)

```groovy
id "org.siouan.frontend-jdk8" version "6.0.0"
id "org.siouan.frontend-jdk11" version "8.0.0"
id "org.siouan.frontend-jdk17" version "8.0.0"
```

* Add also the following code in build.gradle to configure the previous plug-in:

```groovy
frontend {
    nodeVersion = "16.20.2"
    assembleScript = "run build"
    cleanScript = "run clean"
    checkScript = "run check"
}
```

* You can now execute ```./gradlew build```. The tasks related to the frontend are also executed and the frontend code
  is generated.
* You may now execute the application by using ```./gradlew bootRun```

* You may now execute the application by using ```./gradlew bootRun```

* Add a task to gradle to copy the generated jar to a folder named ”dist” located a the project root folder level

```groovy
task copyJarToDist(type: Copy) {
    dependsOn build
    from('build/libs')
    into('dist')
    include('*.jar')
    doFirst {
        // This will ensure the dist directory is created if it doesn't exist
        file('dist').mkdirs()
    }
}
```

* Add a task to gradle to delete all the files generated by webpack (usually located at
  src/resources/main/static/built/).
* This new task should be executed automatically by gradle before the task clean.

```groovy
task cleanWebpack(type: Delete) {
    delete 'src/main/resources/static/built/'
}

clean.dependsOn cleanWebpack
```

* Finally run ```./gradlew clean```

## Part 2.1: Build Tools with Apache Ant

* Copy the following from the previous project.

1. src folder
2. package.json
3. webpack.config.js

* Create a build.xml File: This is Ant's equivalent of pom.xml in Maven. It will contain targets for compiling code,
  copying resources, and creating a JAR or WAR file.

* You can follow this example, changing the project name and main class as needed

```xml

<project name="my-spring-boot-app" default="package" basedir=".">
    <!-- Set global properties for this build -->
    <property name="src.dir" value="src/main/java"/>
    <property name="resources.dir" value="src/main/resources"/>
    <property name="test.dir" value="src/test/java"/>
    <property name="build.dir" value="build"/>
    <property name="dist.dir" value="dist"/>

    <target name="init">
        <!-- Create the build directory structure used by compile -->
        <mkdir dir="${build.dir}"/>
        <mkdir dir="${dist.dir}"/>
    </target>

    <target name="compile" depends="init">
        <!-- Compiles the Java source code -->
        <javac srcdir="${src.dir}" destdir="${build.dir}">
            <classpath>
                <!-- You'll need to add dependency JARs here -->
            </classpath>
        </javac>
        <!-- Copy non-Java resources -->
        <copy todir="${build.dir}">
            <fileset dir="${resources.dir}" excludes="**/*.java"/>
        </copy>
    </target>

    <target name="package" depends="compile, build-frontend">
        <!-- Packages the application into a JAR file -->
        <jar destfile="${dist.dir}/my-app.jar" basedir="${build.dir}">
            <manifest>
                <attribute name="Main-Class" value="com.greglturnquist.payroll.ReactAndSpringDataRestApplication"/>
            </manifest>
        </jar>
    </target>

    <target name="clean">
        <!-- Deletes the build and dist directory -->
        <delete dir="${build.dir}"/>
        <delete dir="${dist.dir}"/>
    </target>

    <target name="build-frontend" depends="init">
        <!-- Runs the npm build script for the frontend -->
        <exec executable="npm" dir="src/main/js">
            <arg value="install"/>
        </exec>
        <exec executable="npm" dir="src/main/js">
            <arg value="run"/>
            <arg value="build"/>
        </exec>
    </target>
</project>
```

### Ivy Setup

#### Step 1: Set Up Ivy

* Download Ivy: If you haven't already, download the Ivy JAR from the Apache Ivy website and place it in your project's
  lib directory or an ant/lib directory where Ant can find it. If you're working within an IDE, there might be an easier
  way to integrate Ivy without manually downloading the JAR.
* Enable Ivy in Your Build: Add the following at the top of your build.xml to make sure Ant knows to use Ivy for this
  build.

```xml

<project name="my-spring-boot-app" default="package" xmlns:ivy="antlib:org.apache.ivy.ant" basedir=".">
    <target name="bootstrap">
        <mkdir dir="${ant.lib.dir}"/>
        <get dest="${ant.lib.dir}/ivy.jar" src="https://repo1.maven.org/maven2/org/apache/ivy/ivy/2.5.0/ivy-2.5.0.jar"/>
    </target>

    <target name="resolve" description="Use Ivy to resolve classpaths">
        <ivy:retrieve pattern="lib/[artifact]-[revision].[ext]"/>
    </target>
</project>
```

#### Step 2: Create Your ivy.xml

* The ivy.xml file is where you specify your project dependencies. You'll define them similarly to how you would in a
Maven pom.xml but with Ivy's XML schema. Here’s a simple example of what your ivy.xml might look like, based on your
project needing Spring Boot and other dependencies:

```xml
<ivy-module version="2.0">
    <info organisation="com.yourcompany" module="my-spring-boot-app"/>
    <dependencies>
        <!-- Spring Boot Starter Web -->
        <dependency org="org.springframework.boot" name="spring-boot-starter-web" rev="2.5.0"/>

        <!-- Spring Boot Starter Data JPA -->
        <dependency org="org.springframework.boot" name="spring-boot-starter-data-jpa" rev="2.5.0"/>

        <!-- H2 Database -->
        <dependency org="com.h2database" name="h2" rev="1.4.200"/>

        <!-- Other dependencies as needed -->
    </dependencies>
</ivy-module>

```

#### Step 3: PENDING

